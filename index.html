<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chicatelier ¬∑ Precifica√ß√£o</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #FAF7F4;
  --surface: #FFFFFF;
  --surface2: #F5F0EB;
  --surface3: #EDE5DC;
  --border: #E0D5C8;
  --border-dark: #C8BAA8;
  --rose: #B5614A;
  --rose-light: #CC7A62;
  --rose-dim: rgba(181,97,74,0.1);
  --rose-deep: #8B3D29;
  --gold: #C4934A;
  --gold-dim: rgba(196,147,74,0.12);
  --sage: #6B9E8A;
  --text: #2A1F16;
  --text-dim: #7A6555;
  --text-muted: #A8927E;
  --shadow: rgba(42,31,22,0.12);
  --success: #5A9E74;
  --danger: #B5503A;
  --google-blue: #4285F4;
  --google-green: #0F9D58;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }
body::before { content:''; position:fixed; inset:0; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E"); pointer-events:none; z-index:1000; opacity:0.6; }

/* HEADER */
header { background:var(--surface); border-bottom:2px solid var(--border); padding:0 40px; display:flex; align-items:center; justify-content:space-between; height:76px; position:sticky; top:0; z-index:200; box-shadow:0 2px 20px var(--shadow); }
.logo-area { display:flex; align-items:center; gap:16px; cursor:pointer; }
.logo-wrap { height:52px; display:flex; align-items:center; }
.logo-wrap img { height:52px; width:auto; object-fit:contain; }
.logo-text-wrap { line-height:1.2; }
.logo-brand { font-family:'Playfair Display',serif; font-size:1.4rem; font-weight:700; color:var(--text); letter-spacing:0.04em; }
.logo-tagline { font-size:0.62rem; color:var(--text-muted); letter-spacing:0.1em; text-transform:uppercase; }
.header-right { display:flex; align-items:center; gap:12px; }
.google-status { display:inline-flex; align-items:center; gap:7px; font-size:0.73rem; padding:6px 14px; border-radius:20px; border:1px solid var(--border); background:var(--surface2); color:var(--text-dim); cursor:pointer; transition:all 0.2s; }
.google-status.connected { background:rgba(15,157,88,0.08); border-color:rgba(15,157,88,0.3); color:var(--google-green); }
.google-dot { width:6px; height:6px; border-radius:50%; background:var(--text-muted); }
.google-status.connected .google-dot { background:var(--google-green); animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.8)} }
nav { display:flex; gap:2px; }
.nav-btn { background:none; border:none; color:var(--text-dim); padding:8px 16px; border-radius:8px; cursor:pointer; font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:500; transition:all 0.2s; border-bottom:2px solid transparent; }
.nav-btn:hover { color:var(--text); background:var(--surface2); }
.nav-btn.active { color:var(--rose); font-weight:600; background:var(--rose-dim); border-bottom-color:var(--rose); }

/* PAGES */
.page { display:none; padding:40px; max-width:1080px; margin:0 auto; animation:fadeUp 0.3s ease; }
.page.active { display:block; }
@keyframes fadeUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

/* SECTION HEADERS */
.section-eyebrow { font-size:0.66rem; letter-spacing:0.14em; text-transform:uppercase; color:var(--rose); margin-bottom:8px; font-weight:600; }
.section-title { font-family:'Playfair Display',serif; font-size:2.1rem; font-weight:700; margin-bottom:8px; line-height:1.2; }
.section-sub { color:var(--text-dim); font-size:0.88rem; margin-bottom:36px; max-width:540px; line-height:1.6; }

/* CARDS */
.card { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:28px; margin-bottom:20px; box-shadow:0 2px 12px var(--shadow); }
.card-header { display:flex; align-items:center; gap:10px; margin-bottom:22px; padding-bottom:16px; border-bottom:1px solid var(--border); }
.card-header h3 { font-family:'Playfair Display',serif; font-size:1.1rem; font-weight:600; }
.card-icon { width:34px; height:34px; border-radius:9px; background:var(--rose-dim); display:flex; align-items:center; justify-content:center; font-size:16px; flex-shrink:0; border:1px solid rgba(181,97,74,0.2); }

/* FORMS */
.form-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(210px,1fr)); gap:14px; }
.form-group { display:flex; flex-direction:column; gap:6px; }
.form-group.span2 { grid-column:span 2; }
.form-group.span3 { grid-column:span 3; }
label { font-size:0.68rem; font-weight:600; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.07em; }
.hint { font-size:0.72rem; color:var(--text-muted); font-style:italic; margin-top:2px; }
input[type=text],input[type=number],input[type=url],select,textarea { background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:10px 14px; font-family:'DM Sans',sans-serif; font-size:0.9rem; color:var(--text); transition:border-color 0.2s,background 0.2s; width:100%; -webkit-appearance:none; }
input:focus,select:focus,textarea:focus { outline:none; border-color:var(--rose); background:var(--surface); box-shadow:0 0 0 3px rgba(181,97,74,0.1); }
select { cursor:pointer; }
textarea { resize:vertical; min-height:80px; }
input::placeholder { color:var(--text-muted); }
.pfx { position:relative; }
.pfx input { padding-left:36px; }
.pfx-symbol { position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text-muted); font-size:0.8rem; font-weight:600; pointer-events:none; }

/* BUTTONS */
.btn { display:inline-flex; align-items:center; gap:7px; padding:11px 22px; border:none; border-radius:10px; cursor:pointer; font-family:'DM Sans',sans-serif; font-weight:600; font-size:0.87rem; transition:all 0.2s; letter-spacing:0.01em; }
.btn-primary { background:var(--rose); color:white; }
.btn-primary:hover { background:var(--rose-deep); transform:translateY(-1px); box-shadow:0 6px 20px rgba(181,97,74,0.3); }
.btn-ghost { background:var(--surface2); color:var(--text); border:1px solid var(--border); }
.btn-ghost:hover { background:var(--surface3); border-color:var(--rose); }
.btn-google-green { background:var(--google-green); color:white; }
.btn-google-green:hover { background:#0a7a44; transform:translateY(-1px); }
.btn-gold { background:var(--gold); color:white; }
.btn-gold:hover { background:#a87730; transform:translateY(-1px); }
.btn-danger { background:rgba(181,80,58,0.1); color:var(--danger); border:1px solid rgba(181,80,58,0.25); }
.btn-danger:hover { background:rgba(181,80,58,0.18); }
.btn-sm { padding:7px 14px; font-size:0.78rem; border-radius:8px; }

/* ALERTS */
.alert { padding:12px 16px; border-radius:10px; font-size:0.84rem; margin-bottom:16px; display:flex; gap:10px; align-items:flex-start; line-height:1.5; }
.alert-sage { background:rgba(107,158,138,0.1); border:1px solid rgba(107,158,138,0.3); color:#3d7060; }
.alert-gold { background:var(--gold-dim); border:1px solid rgba(196,147,74,0.25); color:#8B6420; }
.alert-rose { background:var(--rose-dim); border:1px solid rgba(181,97,74,0.25); color:var(--rose-deep); }

/* STAT TILES */
.stat-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:12px; margin-bottom:24px; }
.stat-tile { background:var(--surface2); border:1px solid var(--border); border-radius:12px; padding:16px; text-align:center; }
.stat-tile .val { font-family:'Playfair Display',serif; font-size:1.45rem; font-weight:700; color:var(--rose); }
.stat-tile .lbl { font-size:0.67rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.07em; margin-top:4px; }

/* SEP */
.sep { height:1px; background:var(--border); margin:20px 0; }

/* CATEGORY SELECTOR */
.cat-selector { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:10px; margin-bottom:28px; }
.cat-card { background:var(--surface); border:2px solid var(--border); border-radius:14px; padding:18px 14px; cursor:pointer; transition:all 0.2s; text-align:center; }
.cat-card:hover { border-color:var(--rose-light); transform:translateY(-2px); box-shadow:0 6px 20px var(--shadow); }
.cat-card.active { border-color:var(--rose); background:var(--rose-dim); }
.cat-card-icon { font-size:2rem; margin-bottom:8px; display:block; }
.cat-card-name { font-family:'Playfair Display',serif; font-size:0.9rem; font-weight:600; color:var(--text); line-height:1.3; }
.cat-card-desc { font-size:0.7rem; color:var(--text-muted); margin-top:4px; line-height:1.4; }

/* DYNAMIC SECTION */
.dynamic-section { display:none; }
.dynamic-section.active { display:block; }

/* INSUMO ROWS */
.insumo-row { display:grid; grid-template-columns:1fr 120px 70px auto; gap:8px; align-items:center; margin-bottom:8px; }

/* RESULT PANEL */
.result-panel { background:linear-gradient(135deg,#FDF8F4 0%,#F8EFE5 100%); border:2px solid var(--border); border-radius:18px; padding:30px; margin-top:24px; position:relative; overflow:hidden; }
.result-panel::before { content:'‚ú¶'; position:absolute; top:-30px; right:20px; font-size:160px; opacity:0.04; color:var(--rose); font-family:'Playfair Display',serif; pointer-events:none; }
.result-panel h3 { font-family:'Playfair Display',serif; font-size:1.15rem; color:var(--rose-deep); margin-bottom:20px; font-weight:700; }
.r-row { display:flex; justify-content:space-between; padding:9px 0; border-bottom:1px solid rgba(0,0,0,0.06); font-size:0.87rem; }
.r-row .lbl { color:var(--text-dim); }
.r-row .val { font-weight:600; color:var(--text); }
.r-row.highlight .val { color:var(--gold); }
.r-total { display:flex; justify-content:space-between; padding:18px 0 0; margin-top:8px; align-items:flex-end; }
.r-total .lbl { font-size:0.75rem; text-transform:uppercase; letter-spacing:0.08em; color:var(--text-muted); }
.r-total .val { font-family:'Playfair Display',serif; font-size:2.6rem; font-weight:700; color:var(--rose); line-height:1; }
.margin-pills { display:flex; gap:6px; flex-wrap:wrap; margin-top:18px; }
.mpill { padding:6px 14px; border-radius:20px; font-size:0.78rem; font-weight:600; cursor:pointer; border:1px solid var(--border); color:var(--text-dim); background:var(--surface2); transition:all 0.18s; }
.mpill:hover,.mpill.on { background:var(--rose); border-color:var(--rose); color:white; }

/* PRODUCT CARDS */
.prod-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; }
.prod-card { background:var(--surface); border:1px solid var(--border); border-radius:14px; overflow:hidden; transition:transform 0.2s,box-shadow 0.2s; box-shadow:0 2px 8px var(--shadow); }
.prod-card:hover { transform:translateY(-3px); box-shadow:0 12px 32px var(--shadow); border-color:var(--rose); }
.prod-card-top { background:linear-gradient(135deg,var(--surface2),var(--surface3)); padding:20px; display:flex; align-items:flex-start; gap:14px; border-bottom:1px solid var(--border); }
.prod-emoji { font-size:2.2rem; }
.prod-meta h3 { font-family:'Playfair Display',serif; font-size:1.05rem; font-weight:600; }
.prod-meta .cat { font-size:0.72rem; color:var(--text-muted); margin-top:2px; }
.prod-card-body { padding:16px 20px 20px; }
.prod-price { font-family:'Playfair Display',serif; font-size:1.85rem; font-weight:700; color:var(--rose); line-height:1; }
.prod-cost { font-size:0.78rem; color:var(--text-muted); margin-top:4px; }
.prod-desc { font-size:0.81rem; color:var(--text-dim); margin-top:10px; line-height:1.5; }
.prod-actions { display:flex; gap:8px; margin-top:14px; flex-wrap:wrap; }
.prod-date { font-size:0.7rem; color:var(--text-muted); margin-top:8px; }

/* CATALOG */
.cat-hero { background:linear-gradient(135deg,var(--surface) 0%,var(--surface2) 100%); border:2px solid var(--border); border-radius:20px; padding:52px 48px; margin-bottom:32px; text-align:center; box-shadow:0 4px 24px var(--shadow); position:relative; overflow:hidden; }
.cat-hero::before { content:''; position:absolute; inset:0; background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Cpath d='M30 2 L58 30 L30 58 L2 30Z' fill='none' stroke='%23B5614A' stroke-width='0.4' opacity='0.08'/%3E%3C/svg%3E"); pointer-events:none; }
.cat-logo-placeholder { font-size:52px; display:block; margin-bottom:4px; }
.cat-title { font-family:'Playfair Display',serif; font-size:3.2rem; font-weight:700; color:var(--text); line-height:1; }
.cat-subtitle { color:var(--text-dim); font-size:0.95rem; margin-top:10px; font-style:italic; }
.cat-actions { display:flex; gap:10px; justify-content:center; margin-top:22px; flex-wrap:wrap; }
.cat-divider { text-align:center; margin:28px 0; color:var(--text-muted); font-size:0.8rem; letter-spacing:0.15em; text-transform:uppercase; display:flex; align-items:center; gap:12px; }
.cat-divider::before,.cat-divider::after { content:''; flex:1; height:1px; background:var(--border); }
.cat-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px; }
.cat-item { background:var(--surface); border:1px solid var(--border); border-radius:14px; overflow:hidden; box-shadow:0 2px 8px var(--shadow); }
.cat-item-img { height:110px; background:linear-gradient(135deg,var(--surface2),var(--surface3)); display:flex; align-items:center; justify-content:center; font-size:46px; border-bottom:1px solid var(--border); }
.cat-item-body { padding:16px; }
.cat-item-name { font-family:'Playfair Display',serif; font-size:1rem; font-weight:600; margin-bottom:6px; }
.cat-item-desc { font-size:0.78rem; color:var(--text-dim); line-height:1.5; margin-bottom:12px; }
.cat-item-price { font-family:'Playfair Display',serif; font-size:1.45rem; font-weight:700; color:var(--rose); }
.cat-item-cat { font-size:0.67rem; text-transform:uppercase; letter-spacing:0.09em; color:var(--text-muted); margin-top:4px; }

/* GOOGLE PAGE */
.google-card { border:2px dashed rgba(66,133,244,0.3); background:rgba(66,133,244,0.03); border-radius:16px; padding:28px; margin-bottom:20px; }
.google-card.connected { border-color:rgba(15,157,88,0.3); background:rgba(15,157,88,0.03); }
.sheet-url-row { display:flex; gap:10px; align-items:flex-end; }
.sheet-url-row .form-group { flex:1; }

/* EMPTY */
.empty { text-align:center; padding:64px 20px; color:var(--text-muted); }
.empty-icon { font-size:52px; margin-bottom:16px; display:block; }
.empty h3 { font-family:'Playfair Display',serif; font-size:1.5rem; color:var(--text-dim); margin-bottom:8px; }

/* TOAST */
#toast { position:fixed; bottom:32px; right:32px; background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:14px 20px; font-size:0.88rem; color:var(--text); z-index:9999; display:none; animation:slideIn 0.3s ease; box-shadow:0 8px 32px var(--shadow); max-width:320px; }
@keyframes slideIn { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }

/* LOADING */
.loading-overlay { display:none; position:fixed; inset:0; background:rgba(250,247,244,0.85); z-index:500; align-items:center; justify-content:center; flex-direction:column; gap:16px; backdrop-filter:blur(8px); }
.loading-overlay.show { display:flex; }
.spinner { width:40px; height:40px; border:3px solid var(--border); border-top-color:var(--rose); border-radius:50%; animation:spin 0.8s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }

/* PROG BAR */
.prog-wrap { margin-top:14px; }
.prog-bar { height:5px; background:var(--surface3); border-radius:3px; overflow:hidden; margin-top:8px; }
.prog-fill { height:100%; background:linear-gradient(90deg,var(--sage),var(--rose)); transition:width 0.4s ease; border-radius:3px; }
.prog-label { font-size:0.76rem; color:var(--text-muted); }

/* MOBILE */
@media (max-width:700px) {
  header { padding:0 16px; height:64px; }
  nav { display:none; }
  .mobile-nav { display:flex !important; }
  .page { padding:20px 16px 100px; }
  .form-grid { grid-template-columns:1fr; }
  .form-group.span2,.form-group.span3 { grid-column:span 1; }
  .insumo-row { grid-template-columns:1fr 100px 60px auto; }
  .cat-selector { grid-template-columns:repeat(auto-fill,minmax(130px,1fr)); }
}
.mobile-nav { display:none; position:fixed; bottom:0; left:0; right:0; background:var(--surface); border-top:1px solid var(--border); z-index:300; justify-content:space-around; padding:8px 0 16px; box-shadow:0 -4px 20px var(--shadow); }
.mobile-nav-btn { background:none; border:none; color:var(--text-muted); font-size:0.6rem; font-family:'DM Sans',sans-serif; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:4px; padding:6px; transition:color 0.2s; }
.mobile-nav-btn span { font-size:1.3rem; }
.mobile-nav-btn.active { color:var(--rose); }

@media print {
  header,.mobile-nav,#toast,.btn,.cat-actions input { display:none !important; }
  body { background:white; }
  .page { display:block !important; padding:20px; }
}
</style>
</head>
<body>

<div class="loading-overlay" id="loading">
  <div class="spinner"></div>
  <div style="color:var(--text-dim);font-size:0.85rem;">Carregando...</div>
</div>

<header>
  <div class="logo-area" onclick="showPage('config')">
    <div class="logo-wrap">
      <img id="header-logo" src="" alt="Logo" style="display:none;">
      <span id="header-logo-emoji" style="font-size:2rem;">ü™°</span>
    </div>
    <div class="logo-text-wrap">
      <div class="logo-brand" id="header-name">Chicatelier</div>
      <div class="logo-tagline">Sistema de Precifica√ß√£o</div>
    </div>
  </div>
  <nav>
    <button class="nav-btn active" onclick="showPage('config')">‚öô Configura√ß√µes</button>
    <button class="nav-btn" onclick="showPage('calc')">‚ú¶ Calcular</button>
    <button class="nav-btn" onclick="showPage('produtos')">üì¶ Produtos</button>
    <button class="nav-btn" onclick="showPage('catalogo')">üìñ Cat√°logo</button>
    <button class="nav-btn" onclick="showPage('google')">üîó Google</button>
  </nav>
  <div class="google-status" id="google-status-badge" onclick="showPage('google')">
    <div class="google-dot"></div>
    <span id="google-status-text">Conectar Google</span>
  </div>
</header>

<div class="mobile-nav">
  <button class="mobile-nav-btn active" onclick="showPage('config')"><span>‚öô</span>Config</button>
  <button class="mobile-nav-btn" onclick="showPage('calc')"><span>‚ú¶</span>Calcular</button>
  <button class="mobile-nav-btn" onclick="showPage('produtos')"><span>üì¶</span>Produtos</button>
  <button class="mobile-nav-btn" onclick="showPage('catalogo')"><span>üìñ</span>Cat√°logo</button>
  <button class="mobile-nav-btn" onclick="showPage('google')"><span>üîó</span>Google</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: CONFIGURA√á√ïES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-config">
  <div class="section-eyebrow">Base do sistema</div>
  <div class="section-title">Configura√ß√µes do Atelier</div>
  <div class="section-sub">Defina seus custos fixos e horas de trabalho. Esses dados alimentam o c√°lculo autom√°tico de todos os produtos.</div>

  <div class="card">
    <div class="card-header"><div class="card-icon">üé®</div><h3>Identidade do Atelier</h3></div>
    <div class="form-grid">
      <div class="form-group span2"><label>Nome do Atelier</label><input type="text" id="atelier_nome" value="Chicatelier" oninput="updateNome()"></div>
      <div class="form-group span2"><label>Slogan</label><input type="text" id="atelier_slogan" value="feito para voc√™" oninput="updateNome()"></div>
      <div class="form-group span2">
        <label>Logo</label>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
          <input type="url" id="logo_url" placeholder="https://... ou fa√ßa upload" oninput="applyLogoUrl()">
          <label class="btn btn-ghost btn-sm" style="cursor:pointer;flex-shrink:0;">üìÅ Upload<input type="file" accept="image/*" style="display:none;" onchange="handleLogoUpload(this)"></label>
        </div>
      </div>
    </div>
    <div id="logo-preview-wrap" style="margin-top:14px;display:none;"><img id="logo-preview-img" style="max-height:80px;max-width:200px;border-radius:8px;border:1px solid var(--border);"></div>
  </div>

  <div class="card">
    <div class="card-header"><div class="card-icon">üè†</div><h3>Custos Fixos Mensais</h3></div>
    <div class="alert alert-sage">üí° Use apenas a parte proporcional de cada despesa que pertence ao atelier.</div>
    <div class="form-grid">
      <div class="form-group"><label>Aluguel (parte atelier)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="cf_aluguel" value="180" step="0.01" oninput="liveConfig()"></div><div class="hint">Ex: 30% de R$600</div></div>
      <div class="form-group"><label>Internet</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="cf_internet" value="50" step="0.01" oninput="liveConfig()"></div></div>
      <div class="form-group"><label>√Ågua</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="cf_agua" value="67.50" step="0.01" oninput="liveConfig()"></div></div>
      <div class="form-group"><label>Energia</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="cf_energia" value="125" step="0.01" oninput="liveConfig()"></div></div>
      <div class="form-group"><label>Manuten√ß√£o m√°quinas</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="cf_mnt" value="150" step="0.01" oninput="liveConfig()"></div><div class="hint">Bordado + costura + solda</div></div>
      <div class="form-group"><label>Consum√≠veis gerais</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="cf_consumo" value="33.34" step="0.01" oninput="liveConfig()"></div></div>
      <div class="form-group"><label>Outros</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="cf_outros" value="0" step="0.01" oninput="liveConfig()"></div></div>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><div class="card-icon">‚è∞</div><h3>Horas de Trabalho Mensais</h3></div>
    <div class="alert alert-gold">‚ö† Inclua madrugadas! Suas horas reais calculam o custo verdadeiro da sua hora.</div>
    <div class="form-grid">
      <div class="form-group"><label>S√°bados / m√™s</label><input type="number" id="h_sab_dias" value="4" min="0" max="5" oninput="liveConfig()"></div>
      <div class="form-group"><label>Horas por s√°bado</label><input type="number" id="h_sab_hrs" value="14" min="0" max="24" oninput="liveConfig()"><div class="hint">Incl. madrugada</div></div>
      <div class="form-group"><label>Domingos / m√™s</label><input type="number" id="h_dom_dias" value="4" min="0" max="5" oninput="liveConfig()"></div>
      <div class="form-group"><label>Horas por domingo</label><input type="number" id="h_dom_hrs" value="14" min="0" max="24" oninput="liveConfig()"></div>
      <div class="form-group"><label>Noites de semana</label><input type="number" id="h_sem_dias" value="5" min="0" max="7" oninput="liveConfig()"><div class="hint">Por semana</div></div>
      <div class="form-group"><label>Horas por noite</label><input type="number" id="h_sem_hrs" value="3" min="0" max="8" oninput="liveConfig()"></div>
    </div>
    <div id="horas-stats" class="stat-grid" style="margin-top:20px;"></div>
  </div>

  <div class="card">
    <div class="card-header"><div class="card-icon">üí∞</div><h3>Remunera√ß√£o e Margem</h3></div>
    <div class="form-grid">
      <div class="form-group"><label>Pr√≥-labore mensal</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="cf_prolabore" value="3500" step="50" oninput="liveConfig()"></div></div>
      <div class="form-group"><label>Margem de lucro padr√£o (%)</label><input type="number" id="cf_lucro" value="20" min="0" max="300" step="5" oninput="liveConfig()"></div>
    </div>
  </div>

  <div id="config-resumo" class="stat-grid"></div>

  <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:8px;flex-wrap:wrap;">
    <button class="btn btn-ghost" onclick="resetConfig()">‚Ü∫ Redefinir</button>
    <button class="btn btn-primary" onclick="saveConfig()">üíæ Salvar</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: CALCULAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-calc">
  <div class="section-eyebrow">Precifica√ß√£o</div>
  <div class="section-title">Calcular Produto</div>
  <div class="section-sub">Escolha a categoria do produto. Os campos se adaptam automaticamente para cada tipo de trabalho.</div>

  <!-- IDENTIFICA√á√ÉO -->
  <div class="card">
    <div class="card-header"><div class="card-icon">üè∑</div><h3>Identifica√ß√£o</h3></div>
    <div class="form-grid">
      <div class="form-group span2"><label>Nome do produto *</label><input type="text" id="p_nome" placeholder="Ex: Necessaire bordada rosa" oninput="calcPreco()"></div>
      <div class="form-group"><label>√çcone</label>
        <select id="p_emoji" oninput="calcPreco()">
          <option>üßµ</option><option>üå∏</option><option>üéÄ</option><option>üëú</option>
          <option>üß£</option><option>ü™°</option><option>‚ú®</option><option>üéÅ</option>
          <option>üåø</option><option>üíê</option><option>ü¶ã</option><option>üåπ</option>
          <option>üîë</option><option>üë∂</option><option>üè†</option><option>ü™¢</option>
          <option>üìö</option><option>üõÅ</option><option>üß∏</option>
        </select>
      </div>
      <div class="form-group span3"><label>Descri√ß√£o para o cat√°logo</label><textarea id="p_desc" placeholder="T√©cnica, materiais, tamanho, personaliza√ß√£o..."></textarea></div>
    </div>
  </div>

  <!-- SELETOR DE CATEGORIA -->
  <div class="card">
    <div class="card-header"><div class="card-icon">üìÇ</div><h3>Tipo de Produto</h3></div>
    <div class="alert alert-rose">‚ú¶ Escolha a categoria ‚Äî os campos de custo se adaptam para cada tipo de trabalho!</div>
    <div class="cat-selector">
      <div class="cat-card active" onclick="selecionarCat('bordado')" id="cat-bordado">
        <span class="cat-card-icon">üßµ</span>
        <div class="cat-card-name">Bordado</div>
        <div class="cat-card-desc">Bordados em geral, toalhas, enxoval</div>
      </div>
      <div class="cat-card" onclick="selecionarCat('ajuste')" id="cat-ajuste">
        <span class="cat-card-icon">‚úÇÔ∏è</span>
        <div class="cat-card-name">Ajuste de Roupa</div>
        <div class="cat-card-desc">Z√≠per, el√°stico, bot√£o, bainha</div>
      </div>
      <div class="cat-card" onclick="selecionarCat('chaveiro')" id="cat-chaveiro">
        <span class="cat-card-icon">üîë</span>
        <div class="cat-card-name">Chaveiro</div>
        <div class="cat-card-desc">Clich√™ em baixo relevo, personalizado</div>
      </div>
      <div class="cat-card" onclick="selecionarCat('bolsa')" id="cat-bolsa">
        <span class="cat-card-icon">üëú</span>
        <div class="cat-card-name">Necessaire / Bolsa</div>
        <div class="cat-card-desc">Tecidos, z√≠per, forro, al√ßa, bordado</div>
      </div>
      <div class="cat-card" onclick="selecionarCat('enxoval_bebe')" id="cat-enxoval_bebe">
        <span class="cat-card-icon">üë∂</span>
        <div class="cat-card-name">Enxoval Beb√™</div>
        <div class="cat-card-desc">Roupinhas, toalhas, manta, kit</div>
      </div>
      <div class="cat-card" onclick="selecionarCat('enxoval_casa')" id="cat-enxoval_casa">
        <span class="cat-card-icon">üõÅ</span>
        <div class="cat-card-name">Enxoval Casa</div>
        <div class="cat-card-desc">Cama, mesa e banho</div>
      </div>
      <div class="cat-card" onclick="selecionarCat('etiqueta')" id="cat-etiqueta">
        <span class="cat-card-icon">üìö</span>
        <div class="cat-card-name">Etiqueta Escolar</div>
        <div class="cat-card-desc">Lote de etiquetas bordadas</div>
      </div>
      <div class="cat-card" onclick="selecionarCat('outros')" id="cat-outros">
        <span class="cat-card-icon">‚ú®</span>
        <div class="cat-card-name">Outros</div>
        <div class="cat-card-desc">Produto livre ‚Äî campos flex√≠veis</div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ SE√á√ÉO: BORDADO ‚îÄ‚îÄ -->
  <div class="dynamic-section active" id="sec-bordado">
    <div class="card">
      <div class="card-header"><div class="card-icon">‚è±</div><h3>Tempo de Execu√ß√£o ‚Äî Bordado</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Bordado (min)</label><input type="number" id="b_min_bord" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Complexidade</label>
          <select id="b_complexidade" oninput="calcPreco()">
            <option value="1">Simples (at√© 10 min)</option>
            <option value="1.2">M√©dio (10‚Äì30 min)</option>
            <option value="1.5">Complexo (30‚Äì60 min)</option>
            <option value="1.8">Premium (60 min+)</option>
          </select>
        </div>
        <div class="form-group"><label>Costura (min)</label><input type="number" id="b_min_cos" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Acabamento (min)</label><input type="number" id="b_min_acab" value="0" min="0" step="5" oninput="calcPreco()"></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">ü™°</div><h3>Linhas de Bordar</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Meadas usadas</label><input type="number" id="b_linhas" value="1" min="0" step="0.25" oninput="calcPreco()"></div>
        <div class="form-group"><label>Pre√ßo m√©dio da meada</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="b_linha_val" value="18" step="0.50" oninput="calcPreco()"></div></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">üß∂</div><h3>Materiais Diretos</h3><button class="btn btn-ghost btn-sm" style="margin-left:auto;" onclick="addInsumo('bordado')">Ôºã Adicionar</button></div>
      <div id="insumos-bordado"></div>
      <div id="empty-bordado" style="font-size:0.82rem;color:var(--text-muted);text-align:center;padding:12px 0;">Clique em "+ Adicionar" para incluir tecido, entretela, etc.</div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ SE√á√ÉO: AJUSTE DE ROUPA ‚îÄ‚îÄ -->
  <div class="dynamic-section" id="sec-ajuste">
    <div class="card">
      <div class="card-header"><div class="card-icon">‚è±</div><h3>Tempo de Execu√ß√£o ‚Äî Ajuste</h3></div>
      <div class="alert alert-sage">üí° Inclua o tempo de m√°quina de costura no tempo de costura.</div>
      <div class="form-grid">
        <div class="form-group"><label>Costura / m√°quina (min)</label><input type="number" id="aj_min_cos" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Acabamento / prova (min)</label><input type="number" id="aj_min_acab" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Complexidade do ajuste</label>
          <select id="aj_complexidade" oninput="calcPreco()">
            <option value="1">Simples (bainha, bot√£o)</option>
            <option value="1.3">M√©dio (el√°stico, z√≠per)</option>
            <option value="1.6">Complexo (reformula√ß√£o)</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">üßµ</div><h3>Aviamentos e Insumos</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Z√≠per</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="aj_ziper" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>El√°stico (metros)</label><input type="number" id="aj_elastico_m" value="0" step="0.1" oninput="calcPreco()"></div>
        <div class="form-group"><label>Pre√ßo el√°stico / metro</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="aj_elastico_val" value="3.50" step="0.10" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Bot√µes (qtd)</label><input type="number" id="aj_botao_qtd" value="0" step="1" oninput="calcPreco()"></div>
        <div class="form-group"><label>Pre√ßo por bot√£o</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="aj_botao_val" value="1.50" step="0.10" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Entretela (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="aj_entretela" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Tecido extra (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="aj_tecido" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Linha especial (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="aj_linha" value="0" step="0.01" oninput="calcPreco()"></div></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ SE√á√ÉO: CHAVEIRO ‚îÄ‚îÄ -->
  <div class="dynamic-section" id="sec-chaveiro">
    <div class="card">
      <div class="card-header"><div class="card-icon">‚è±</div><h3>Tempo de Execu√ß√£o ‚Äî Chaveiro</h3></div>
      <div class="alert alert-sage">üí° Inclua o tempo do ferro de solda e da costura da base separadamente.</div>
      <div class="form-grid">
        <div class="form-group"><label>Ferro de solda / clich√™ (min)</label><input type="number" id="ch_min_solda" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Costura da base (min)</label><input type="number" id="ch_min_cos" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Acabamento / montagem (min)</label><input type="number" id="ch_min_acab" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Complexidade do clich√™</label>
          <select id="ch_complexidade" oninput="calcPreco()">
            <option value="1">Simples (texto ou forma b√°sica)</option>
            <option value="1.3">M√©dio (desenho com detalhes)</option>
            <option value="1.6">Complexo (personaliza√ß√£o total)</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">üîë</div><h3>Materiais do Chaveiro</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Material base (couro, EVA‚Ä¶)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ch_material_base" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Argola / mosquet√£o</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ch_argola" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Fio de cera / linha</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ch_fio" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Enfeites / pingentes</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ch_enfeites" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Outros insumos</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ch_outros_mat" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Unidades no lote</label><input type="number" id="ch_unid" value="1" min="1" oninput="calcPreco()"><div class="hint">Divide o custo por pe√ßa</div></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ SE√á√ÉO: BOLSA / NECESSAIRE ‚îÄ‚îÄ -->
  <div class="dynamic-section" id="sec-bolsa">
    <div class="card">
      <div class="card-header"><div class="card-icon">‚è±</div><h3>Tempo de Execu√ß√£o ‚Äî Necessaire / Bolsa</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Corte e preparo (min)</label><input type="number" id="bl_min_corte" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Costura (min)</label><input type="number" id="bl_min_cos" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Bordado / personaliza√ß√£o (min)</label><input type="number" id="bl_min_bord" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Acabamento (min)</label><input type="number" id="bl_min_acab" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Complexidade geral</label>
          <select id="bl_complexidade" oninput="calcPreco()">
            <option value="1">Simples (sem bordado)</option>
            <option value="1.2">M√©dio (bordado simples)</option>
            <option value="1.5">Complexo (bordado detalhado)</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">üëú</div><h3>Materiais ‚Äî Tecidos e Estrutura</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Tecido externo (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="bl_tec_ext" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Forro interno (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="bl_forro" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Entretela / manta (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="bl_entretela" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Z√≠per</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="bl_ziper" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Al√ßa / fita (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="bl_alca" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Linha de bordar (meadas)</label><input type="number" id="bl_linhas" value="0" step="0.25" oninput="calcPreco()"></div>
        <div class="form-group"><label>Pre√ßo da meada</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="bl_linha_val" value="18" step="0.50" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Outros aviamentos (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="bl_outros" value="0" step="0.01" oninput="calcPreco()"></div></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ SE√á√ÉO: ENXOVAL BEB√ä ‚îÄ‚îÄ -->
  <div class="dynamic-section" id="sec-enxoval_bebe">
    <div class="card">
      <div class="card-header"><div class="card-icon">‚è±</div><h3>Tempo de Execu√ß√£o ‚Äî Enxoval Beb√™</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Bordado (min)</label><input type="number" id="eb_min_bord" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Complexidade bordado</label>
          <select id="eb_complexidade" oninput="calcPreco()">
            <option value="1">Simples</option>
            <option value="1.2">M√©dio</option>
            <option value="1.5">Complexo</option>
            <option value="1.8">Premium</option>
          </select>
        </div>
        <div class="form-group"><label>Costura / confec√ß√£o (min)</label><input type="number" id="eb_min_cos" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Acabamento (min)</label><input type="number" id="eb_min_acab" value="0" min="0" step="5" oninput="calcPreco()"></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">üë∂</div><h3>Materiais ‚Äî Enxoval Beb√™</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Tecido (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="eb_tecido" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Linha de bordar (meadas)</label><input type="number" id="eb_linhas" value="1" step="0.25" oninput="calcPreco()"></div>
        <div class="form-group"><label>Pre√ßo da meada</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="eb_linha_val" value="18" step="0.50" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Aviamentos (el√°stico, z√≠per‚Ä¶)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="eb_aviamentos" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Embalagem presente (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="eb_embal" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Unidades no kit</label><input type="number" id="eb_unid" value="1" min="1" oninput="calcPreco()"><div class="hint">Divide o custo por pe√ßa</div></div>
      </div>
      <div style="margin-top:16px;">
        <div class="card-header" style="border:none;margin-bottom:12px;padding-bottom:0;"><div class="card-icon">üß∂</div><h3 style="font-size:0.95rem;">Outros materiais</h3><button class="btn btn-ghost btn-sm" style="margin-left:auto;" onclick="addInsumo('enxoval_bebe')">Ôºã</button></div>
        <div id="insumos-enxoval_bebe"></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ SE√á√ÉO: ENXOVAL CASA ‚îÄ‚îÄ -->
  <div class="dynamic-section" id="sec-enxoval_casa">
    <div class="card">
      <div class="card-header"><div class="card-icon">‚è±</div><h3>Tempo de Execu√ß√£o ‚Äî Enxoval Casa</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Bordado (min)</label><input type="number" id="ec_min_bord" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Complexidade bordado</label>
          <select id="ec_complexidade" oninput="calcPreco()">
            <option value="1">Simples</option>
            <option value="1.2">M√©dio</option>
            <option value="1.5">Complexo</option>
            <option value="1.8">Premium</option>
          </select>
        </div>
        <div class="form-group"><label>Costura / acabamento (min)</label><input type="number" id="ec_min_cos" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Tipo de pe√ßa</label>
          <select id="ec_tipo" oninput="calcPreco()">
            <option value="avulso">Pe√ßa avulsa</option>
            <option value="jogo">Jogo / conjunto</option>
            <option value="kit">Kit completo</option>
          </select>
        </div>
        <div class="form-group"><label>Unidades no jogo / kit</label><input type="number" id="ec_unid" value="1" min="1" oninput="calcPreco()"><div class="hint">Para dividir custo por pe√ßa</div></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">üõÅ</div><h3>Materiais ‚Äî Enxoval Casa</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Tecido / toalha / len√ßol (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ec_tecido" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Linha de bordar (meadas)</label><input type="number" id="ec_linhas" value="1" step="0.25" oninput="calcPreco()"></div>
        <div class="form-group"><label>Pre√ßo da meada</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ec_linha_val" value="18" step="0.50" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Aviamentos (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ec_aviamentos" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Embalagem (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ec_embal" value="0" step="0.01" oninput="calcPreco()"></div></div>
      </div>
      <div style="margin-top:16px;">
        <div class="card-header" style="border:none;margin-bottom:12px;padding-bottom:0;"><div class="card-icon">üß∂</div><h3 style="font-size:0.95rem;">Outros materiais</h3><button class="btn btn-ghost btn-sm" style="margin-left:auto;" onclick="addInsumo('enxoval_casa')">Ôºã</button></div>
        <div id="insumos-enxoval_casa"></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ SE√á√ÉO: ETIQUETA ESCOLAR ‚îÄ‚îÄ -->
  <div class="dynamic-section" id="sec-etiqueta">
    <div class="card">
      <div class="card-header"><div class="card-icon">‚è±</div><h3>Tempo de Execu√ß√£o ‚Äî Etiquetas</h3></div>
      <div class="alert alert-sage">üí° Preencha o tempo total para o lote inteiro. O custo ser√° dividido por etiqueta.</div>
      <div class="form-grid">
        <div class="form-group"><label>Bordado total (min)</label><input type="number" id="et_min_bord" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Corte / acabamento total (min)</label><input type="number" id="et_min_acab" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Qtd de etiquetas no lote</label><input type="number" id="et_qtd" value="10" min="1" oninput="calcPreco()"></div>
        <div class="form-group"><label>Complexidade do bordado</label>
          <select id="et_complexidade" oninput="calcPreco()">
            <option value="1">Simples (nome)</option>
            <option value="1.2">M√©dio (nome + √≠cone)</option>
            <option value="1.5">Detalhado</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">üìö</div><h3>Materiais ‚Äî Etiquetas</h3></div>
      <div class="form-grid">
        <div class="form-group"><label>Fita / tecido do lote (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="et_fita" value="0" step="0.01" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Linha de bordar (meadas)</label><input type="number" id="et_linhas" value="1" step="0.25" oninput="calcPreco()"></div>
        <div class="form-group"><label>Pre√ßo da meada</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="et_linha_val" value="18" step="0.50" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Embalagem do lote (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="et_embal" value="0" step="0.01" oninput="calcPreco()"></div></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ SE√á√ÉO: OUTROS ‚îÄ‚îÄ -->
  <div class="dynamic-section" id="sec-outros">
    <div class="card">
      <div class="card-header"><div class="card-icon">‚è±</div><h3>Tempo de Execu√ß√£o</h3></div>
      <div class="alert alert-sage">üí° Use para qualquer produto que ainda n√£o tem categoria. Campos totalmente livres!</div>
      <div class="form-grid">
        <div class="form-group"><label>Tempo total de execu√ß√£o (min)</label><input type="number" id="ou_min_total" value="0" min="0" step="5" oninput="calcPreco()"></div>
        <div class="form-group"><label>Complexidade</label>
          <select id="ou_complexidade" oninput="calcPreco()">
            <option value="1">Simples</option>
            <option value="1.2">M√©dio</option>
            <option value="1.5">Complexo</option>
            <option value="1.8">Premium</option>
          </select>
        </div>
        <div class="form-group"><label>Unidades no lote</label><input type="number" id="ou_unid" value="1" min="1" oninput="calcPreco()"><div class="hint">Divide o custo por pe√ßa</div></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">üß∂</div><h3>Materiais e Insumos</h3><button class="btn btn-ghost btn-sm" style="margin-left:auto;" onclick="addInsumo('outros')">Ôºã Adicionar material</button></div>
      <div class="form-grid" style="margin-bottom:16px;">
        <div class="form-group"><label>Linha / fio (meadas)</label><input type="number" id="ou_linhas" value="0" step="0.25" oninput="calcPreco()"></div>
        <div class="form-group"><label>Pre√ßo da meada</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ou_linha_val" value="18" step="0.50" oninput="calcPreco()"></div></div>
        <div class="form-group"><label>Insumos diversos (R$)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="ou_insumos_fixos" value="0" step="0.01" oninput="calcPreco()"></div></div>
      </div>
      <div id="insumos-outros"></div>
      <div id="empty-outros" style="font-size:0.82rem;color:var(--text-muted);text-align:center;padding:12px 0;">Clique em "+  Adicionar material" para incluir itens espec√≠ficos.</div>
    </div>
  </div>

  <!-- EMBALAGEM + VENDA (geral) -->
  <div class="card">
    <div class="card-header"><div class="card-icon">üì¶</div><h3>Embalagem e Apresenta√ß√£o</h3></div>
    <div class="form-grid">
      <div class="form-group"><label>Saco / caixa / envelope</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="g_embal" value="0" step="0.01" oninput="calcPreco()"></div></div>
      <div class="form-group"><label>Etiqueta personalizada</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="g_etiqu" value="0" step="0.01" oninput="calcPreco()"></div></div>
      <div class="form-group"><label>Tag / cart√£o</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="g_tag" value="0" step="0.01" oninput="calcPreco()"></div></div>
      <div class="form-group"><label>Fita, papel seda, outros</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="g_embal2" value="0" step="0.01" oninput="calcPreco()"></div></div>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><div class="card-icon">üõí</div><h3>Canal de Venda</h3></div>
    <div class="form-grid">
      <div class="form-group"><label>Frete de materiais (rateado)</label><div class="pfx"><span class="pfx-symbol">R$</span><input type="number" id="g_frete" value="0" step="0.01" oninput="calcPreco()"></div></div>
      <div class="form-group"><label>Taxa de marketplace (%)</label><input type="number" id="g_mkt_taxa" value="0" step="0.5" oninput="calcPreco()"><div class="hint">Elo7‚âà12%, Etsy‚âà6.5%</div></div>
      <div class="form-group"><label>Desconto / promo√ß√£o (%)</label><input type="number" id="g_desconto" value="0" step="1" min="0" max="50" oninput="calcPreco()"></div>
    </div>
  </div>

  <!-- RESULT PANEL -->
  <div class="result-panel" id="result-panel">
    <h3>üìä Composi√ß√£o do Pre√ßo</h3>
    <div id="result-rows"></div>
    <div class="sep"></div>
    <div class="r-total">
      <div>
        <div class="lbl">Pre√ßo sugerido</div>
        <div style="font-size:0.72rem;color:var(--text-muted);margin-top:4px;">margem <span id="margem-label">20</span>%</div>
      </div>
      <div class="val" id="preco-final">R$ ‚Äî</div>
    </div>
    <div style="margin-top:16px;">
      <div style="font-size:0.72rem;color:var(--text-muted);margin-bottom:8px;">Simular margem de lucro:</div>
      <div class="margin-pills">
        <button class="mpill" onclick="setMargem(0)">Sem margem</button>
        <button class="mpill" onclick="setMargem(10)">+10%</button>
        <button class="mpill on" onclick="setMargem(20)">+20%</button>
        <button class="mpill" onclick="setMargem(30)">+30%</button>
        <button class="mpill" onclick="setMargem(50)">+50%</button>
        <button class="mpill" onclick="setMargem(100)">+100%</button>
      </div>
    </div>
  </div>

  <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:24px;flex-wrap:wrap;">
    <button class="btn btn-ghost" onclick="limpar()">‚Ü∫ Limpar</button>
    <button class="btn btn-google-green" onclick="salvarSheets()" id="btn-salvar-sheets" style="display:none;">üìä Salvar no Sheets</button>
    <button class="btn btn-gold" onclick="salvar()">‚òÅ Salvar Local</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: PRODUTOS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-produtos">
  <div class="section-eyebrow">Biblioteca</div>
  <div class="section-title">Meus Produtos</div>
  <div class="section-sub">Todos os produtos salvos. Filtre por categoria ou sincronize com o Google Sheets.</div>

  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:20px;">
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('todos')" id="filtro-todos" style="border-color:var(--rose);color:var(--rose);">Todos</button>
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('bordado')">üßµ Bordado</button>
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('ajuste')">‚úÇÔ∏è Ajuste</button>
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('chaveiro')">üîë Chaveiro</button>
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('bolsa')">üëú Bolsa</button>
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('enxoval_bebe')">üë∂ Enxoval Beb√™</button>
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('enxoval_casa')">üõÅ Enxoval Casa</button>
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('etiqueta')">üìö Etiqueta</button>
    <button class="btn btn-ghost btn-sm" onclick="filtrarProd('outros')">‚ú® Outros</button>
  </div>

  <div id="prod-grid" class="prod-grid"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: CAT√ÅLOGO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-catalogo">
  <div class="cat-hero">
    <div class="cat-logo-area" id="cat-logo-area">
      <span class="cat-logo-placeholder" id="cat-logo-emoji">ü™°</span>
    </div>
    <div class="cat-title" id="cat-title">Chicatelier</div>
    <div class="cat-subtitle" id="cat-sub"><em>feito para voc√™</em></div>
    <div class="cat-actions">
      <button class="btn btn-primary btn-sm" onclick="window.print()">üñ® Imprimir / PDF</button>
      <button class="btn btn-ghost btn-sm" onclick="shareCatalog()">üîó Compartilhar</button>
    </div>
  </div>
  <div class="cat-divider">‚ú¶ cole√ß√£o ‚ú¶</div>
  <div id="cat-grid" class="cat-grid"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: GOOGLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-google">
  <div class="section-eyebrow">Integra√ß√£o</div>
  <div class="section-title">Google Sheets & Drive</div>
  <div class="section-sub">Exporte seus produtos automaticamente para o Google Sheets. Dados salvos com seguran√ßa na sua conta Google.</div>

  <div class="google-card" id="google-card-status">
    <div class="card-header" style="border:none;margin-bottom:12px;padding-bottom:0;">
      <div class="card-icon" style="background:rgba(66,133,244,0.1);">üîó</div>
      <h3>Status da Conex√£o</h3>
      <span id="google-status-chip" style="margin-left:auto;font-size:0.75rem;padding:4px 12px;border-radius:20px;background:var(--surface3);color:var(--text-muted);font-weight:600;">N√£o configurado</span>
    </div>
    <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;">A integra√ß√£o usa <strong>Google Apps Script</strong> ‚Äî gratuito, instalado na sua planilha. Seus dados ficam 100% na sua conta Google.</p>
  </div>

  <div class="card">
    <div class="card-header"><div class="card-icon" style="background:rgba(66,133,244,0.1);">1</div><h3>Criar a Planilha</h3></div>
    <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;margin-bottom:16px;">Acesse o Google Sheets e crie uma planilha nova. Nomeie como <strong>"Chicatelier Precifica√ß√£o"</strong>.</p>
    <a href="https://sheets.google.com/create" target="_blank" class="btn btn-google-green">üìä Abrir Google Sheets</a>
  </div>

  <div class="card">
    <div class="card-header"><div class="card-icon" style="background:rgba(66,133,244,0.1);">2</div><h3>Instalar o Apps Script</h3></div>
    <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;margin-bottom:12px;">Na planilha, v√° em <strong>Extens√µes ‚Üí Apps Script</strong>. Apague o c√≥digo existente, cole o c√≥digo abaixo e clique em <strong>üíæ Salvar</strong>. Depois clique em <strong>Implantar ‚Üí Nova implanta√ß√£o ‚Üí Aplicativo da Web</strong> (acesso: <em>Qualquer pessoa</em>). Copie a URL gerada.</p>
    <div id="script-code-box" style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:16px;font-family:monospace;font-size:0.75rem;color:var(--text-dim);overflow-x:auto;white-space:pre;margin-bottom:14px;max-height:240px;overflow-y:auto;line-height:1.6;">const SHEET_NAME = 'Produtos';

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    let sheet = ss.getSheetByName(SHEET_NAME);
    if (!sheet) {
      sheet = ss.insertSheet(SHEET_NAME);
      const headers = ['ID','Data','Nome','Categoria','Tipo','Emoji','Descri√ß√£o',
        'Tempo Total (min)','Custo MO (R$)','Custo Materiais (R$)',
        'Custo Embalagem (R$)','Frete (R$)','Taxa MKT%','Desconto%',
        'Custo Unit (R$)','Margem%','Pre√ßo Final (R$)'];
      sheet.appendRow(headers);
      sheet.getRange(1,1,1,headers.length).setFontWeight('bold')
        .setBackground('#B5614A').setFontColor('white');
      sheet.setFrozenRows(1);
    }
    sheet.appendRow([
      data.id, data.data, data.nome, data.catLabel, data.cat, data.emoji, data.desc||'',
      data.totalMin, Number(data.mo||0).toFixed(2),
      Number(data.matCusto||0).toFixed(2), Number(data.embalagem||0).toFixed(2),
      Number(data.frete||0).toFixed(2), data.mkt_taxa||0, data.desconto||0,
      Number(data.custo||0).toFixed(2), data.margem, Number(data.preco||0).toFixed(2)
    ]);
    const last = sheet.getLastRow();
    sheet.getRange(last,17,1,1).setNumberFormat('R$ #,##0.00');
    sheet.getRange(last,15,1,1).setNumberFormat('R$ #,##0.00');
    return ContentService.createTextOutput(JSON.stringify({success:true}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch(err) {
    return ContentService.createTextOutput(JSON.stringify({success:false,error:err.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  return ContentService.createTextOutput(JSON.stringify({status:'Chicatelier API ativa ‚úì'}))
    .setMimeType(ContentService.MimeType.JSON);
}</div>
    <button class="btn btn-ghost btn-sm" onclick="copiarScript()">üìã Copiar c√≥digo</button>
  </div>

  <div class="card">
    <div class="card-header"><div class="card-icon" style="background:rgba(15,157,88,0.1);">3</div><h3>Conectar ao Sistema</h3></div>
    <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;margin-bottom:14px;">Cole a URL da implanta√ß√£o (come√ßa com <code>https://script.google.com/macros/s/...</code>) e clique em Conectar.</p>
    <div class="sheet-url-row">
      <div class="form-group"><label>URL do Apps Script</label><input type="url" id="sheets_url" placeholder="https://script.google.com/macros/s/..."></div>
      <button class="btn btn-google-green" onclick="conectarSheets()">üîó Conectar</button>
    </div>
    <div id="conn-feedback" style="margin-top:12px;font-size:0.83rem;display:none;"></div>
  </div>

  <div class="card" id="card-sync" style="display:none;">
    <div class="card-header"><div class="card-icon" style="background:rgba(15,157,88,0.1);">üì§</div><h3>Sincronizar Produtos</h3></div>
    <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;margin-bottom:16px;">Envie todos os produtos salvos para o Google Sheets de uma vez.</p>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button class="btn btn-google-green" onclick="syncAllToSheets()">üìä Sincronizar Todos</button>
      <button class="btn btn-ghost" onclick="desconectarSheets()">üîå Desconectar</button>
    </div>
    <div id="sync-log" style="margin-top:14px;font-size:0.82rem;color:var(--text-dim);"></div>
  </div>
</div>

<div id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const KEYS = { config:'chic_config_v4', produtos:'chic_produtos_v4', logo:'chic_logo_v3', sheetsUrl:'chic_sheets_url_v1' };

function showLoading(v) { document.getElementById('loading').classList.toggle('show',v); }
function toast(msg, ok=true) {
  const el = document.getElementById('toast');
  el.innerHTML = (ok?'‚úÖ ':'‚ö†Ô∏è ') + msg;
  el.style.display = 'block';
  el.style.borderColor = ok ? 'rgba(107,158,138,0.5)' : 'rgba(196,147,74,0.5)';
  clearTimeout(el._t);
  el._t = setTimeout(()=>{ el.style.display='none'; }, 3500);
}
async function cloudSet(key, value) { try { await window.storage.set(key, JSON.stringify(value)); return true; } catch(e) { return false; } }
async function cloudGet(key) { try { const r = await window.storage.get(key); return r ? JSON.parse(r.value) : null; } catch { return null; } }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPage(id) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn,.mobile-nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  document.querySelectorAll('.nav-btn,.mobile-nav-btn').forEach(b=>{
    if(b.getAttribute('onclick')&&b.getAttribute('onclick').includes("'"+id+"'")) b.classList.add('active');
  });
  if(id==='produtos') renderProdutos();
  if(id==='catalogo') renderCatalogo();
  if(id==='config') liveConfig();
  if(id==='google') refreshGooglePage();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LOGO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let logoDataUrl = null;
function handleLogoUpload(input) {
  const file = input.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = async(e) => { logoDataUrl = e.target.result; applyLogo(logoDataUrl); await cloudSet(KEYS.logo, logoDataUrl); toast('Logo salva!'); };
  reader.readAsDataURL(file);
}
function applyLogoUrl() { const url = document.getElementById('logo_url').value.trim(); if(url) applyLogo(url); }
function applyLogo(src) {
  if(!src) return; logoDataUrl = src;
  const hImg = document.getElementById('header-logo'); const hEmoji = document.getElementById('header-logo-emoji');
  hImg.src = src; hImg.style.display = 'block'; hEmoji.style.display = 'none';
  const prevWrap = document.getElementById('logo-preview-wrap'); const prevImg = document.getElementById('logo-preview-img');
  prevImg.src = src; prevWrap.style.display = 'block';
  const catArea = document.getElementById('cat-logo-area');
  document.getElementById('cat-logo-emoji').style.display = 'none';
  let catImg = document.getElementById('cat-logo-img');
  if(!catImg) { catImg = document.createElement('img'); catImg.id='cat-logo-img'; catImg.style.cssText='max-height:100px;max-width:240px;border-radius:8px;margin-bottom:8px;display:block;margin-left:auto;margin-right:auto;'; catArea.prepend(catImg); }
  catImg.src = src;
}
function updateNome() {
  const nome = document.getElementById('atelier_nome').value || 'Chicatelier';
  const slogan = document.getElementById('atelier_slogan').value || 'feito para voc√™';
  document.getElementById('header-name').textContent = nome;
  document.getElementById('cat-title').textContent = nome;
  document.getElementById('cat-sub').innerHTML = `<em>${slogan}</em>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function gv(id) { const el = document.getElementById(id); return el ? el.value : '0'; }
function getConfig() {
  return {
    aluguel:+gv('cf_aluguel'), internet:+gv('cf_internet'), agua:+gv('cf_agua'), energia:+gv('cf_energia'),
    mnt:+gv('cf_mnt'), consumo:+gv('cf_consumo'), outros:+gv('cf_outros'),
    prolabore:+gv('cf_prolabore'), lucro:+gv('cf_lucro'),
    h_sab_dias:+gv('h_sab_dias'), h_sab_hrs:+gv('h_sab_hrs'),
    h_dom_dias:+gv('h_dom_dias'), h_dom_hrs:+gv('h_dom_hrs'),
    h_sem_dias:+gv('h_sem_dias'), h_sem_hrs:+gv('h_sem_hrs'),
    nome:gv('atelier_nome'), slogan:gv('atelier_slogan'),
  };
}
function fixoMensal(c) { return c.aluguel+c.internet+c.agua+c.energia+c.mnt+c.consumo+c.outros; }
function horasMensais(c) { return (c.h_sab_dias*c.h_sab_hrs)+(c.h_dom_dias*c.h_dom_hrs)+(c.h_sem_dias*4.33*c.h_sem_hrs); }
function custoHora(c) { const h=horasMensais(c); return h>0?(fixoMensal(c)+c.prolabore)/h:0; }
function custoMin(c) { return custoHora(c)/60; }

function liveConfig() {
  const c = getConfig(); const fixo = fixoMensal(c); const horas = horasMensais(c); const ch = custoHora(c);
  document.getElementById('horas-stats').innerHTML = `
    <div class="stat-tile"><div class="val">${horas.toFixed(0)}h</div><div class="lbl">Horas/m√™s</div></div>
    <div class="stat-tile"><div class="val">R$${ch.toFixed(2)}</div><div class="lbl">Custo/hora</div></div>
    <div class="stat-tile"><div class="val">R$${(ch/60).toFixed(3)}</div><div class="lbl">Custo/minuto</div></div>`;
  document.getElementById('config-resumo').innerHTML = `
    <div class="stat-tile"><div class="val">R$${fixo.toFixed(2)}</div><div class="lbl">Fixo mensal</div></div>
    <div class="stat-tile"><div class="val">R$${(fixo+c.prolabore).toFixed(2)}</div><div class="lbl">Meta mensal</div></div>
    <div class="stat-tile"><div class="val">${horas.toFixed(0)}h</div><div class="lbl">Horas/m√™s</div></div>
    <div class="stat-tile"><div class="val">R$${ch.toFixed(2)}</div><div class="lbl">Valor hora</div></div>`;
  updateNome();
}
async function saveConfig() {
  showLoading(true); const ok = await cloudSet(KEYS.config, getConfig()); showLoading(false);
  if(ok) toast('Configura√ß√µes salvas!'); else toast('Erro ao salvar',false);
}
function resetConfig() {
  if(!confirm('Redefinir para os valores padr√£o?')) return;
  const d = {aluguel:180,internet:50,agua:67.50,energia:125,mnt:150,consumo:33.34,outros:0,prolabore:3500,lucro:20,h_sab_dias:4,h_sab_hrs:14,h_dom_dias:4,h_dom_hrs:14,h_sem_dias:5,h_sem_hrs:3};
  Object.entries(d).forEach(([k,v])=>{ const el=document.getElementById('cf_'+k)||document.getElementById('h_'+k); if(el) el.value=v; });
  liveConfig();
}
async function loadConfig() {
  const c = await cloudGet(KEYS.config); if(!c) return;
  const map = {aluguel:'cf_aluguel',internet:'cf_internet',agua:'cf_agua',energia:'cf_energia',mnt:'cf_mnt',consumo:'cf_consumo',outros:'cf_outros',prolabore:'cf_prolabore',lucro:'cf_lucro',h_sab_dias:'h_sab_dias',h_sab_hrs:'h_sab_hrs',h_dom_dias:'h_dom_dias',h_dom_hrs:'h_dom_hrs',h_sem_dias:'h_sem_dias',h_sem_hrs:'h_sem_hrs'};
  Object.entries(map).forEach(([k,id])=>{ const el=document.getElementById(id); if(el&&c[k]!==undefined) el.value=c[k]; });
  if(c.nome) document.getElementById('atelier_nome').value=c.nome;
  if(c.slogan) document.getElementById('atelier_slogan').value=c.slogan;
  liveConfig();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CATEGORIA SELETOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let catAtual = 'bordado';
const CAT_LABELS = {
  bordado:'Bordado', ajuste:'Ajuste de Roupa', chaveiro:'Chaveiro',
  bolsa:'Necessaire/Bolsa', enxoval_bebe:'Enxoval Beb√™',
  enxoval_casa:'Enxoval Casa', etiqueta:'Etiqueta Escolar', outros:'Outros'
};
const CAT_EMOJIS = {
  bordado:'üßµ', ajuste:'‚úÇÔ∏è', chaveiro:'üîë', bolsa:'üëú',
  enxoval_bebe:'üë∂', enxoval_casa:'üõÅ', etiqueta:'üìö', outros:'‚ú®'
};

function selecionarCat(cat) {
  catAtual = cat;
  document.querySelectorAll('.cat-card').forEach(c=>c.classList.remove('active'));
  document.getElementById('cat-'+cat).classList.add('active');
  document.querySelectorAll('.dynamic-section').forEach(s=>s.classList.remove('active'));
  document.getElementById('sec-'+cat).classList.add('active');
  // set default emoji
  document.getElementById('p_emoji').value = CAT_EMOJIS[cat] || 'üßµ';
  calcPreco();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INSUMOS DIN√ÇMICOS (materiais extras)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const insumos = { bordado:[], enxoval_bebe:[], enxoval_casa:[], outros:[] };

function addInsumo(grupo) {
  insumos[grupo].push({ id: Date.now()+Math.random(), nome:'', custo:0, qtd:1 });
  renderInsumos(grupo);
}
function removeInsumo(grupo, id) { insumos[grupo]=insumos[grupo].filter(m=>m.id!==id); renderInsumos(grupo); calcPreco(); }
function renderInsumos(grupo) {
  const c = document.getElementById('insumos-'+grupo);
  const empty = document.getElementById('empty-'+grupo);
  if(empty) empty.style.display = insumos[grupo].length?'none':'block';
  if(!c) return;
  c.innerHTML = insumos[grupo].map(m=>`
    <div class="insumo-row">
      <input type="text" placeholder="Material" value="${m.nome}" oninput="updateInsumo('${grupo}',${m.id},'nome',this.value)">
      <div class="pfx"><span class="pfx-symbol">R$</span><input type="number" placeholder="0.00" value="${m.custo}" step="0.01" style="padding-left:32px;" oninput="updateInsumo('${grupo}',${m.id},'custo',this.value);calcPreco()"></div>
      <input type="number" placeholder="Qtd" value="${m.qtd}" step="0.01" oninput="updateInsumo('${grupo}',${m.id},'qtd',this.value);calcPreco()">
      <button class="btn btn-danger btn-sm" onclick="removeInsumo('${grupo}',${m.id})">‚úï</button>
    </div>`).join('');
}
function updateInsumo(grupo, id, field, val) { const m=insumos[grupo].find(m=>m.id===id); if(m) m[field]=field==='nome'?val:parseFloat(val)||0; }
function totalInsumos(grupo) { return (insumos[grupo]||[]).reduce((s,m)=>s+((+m.custo)*(+m.qtd)),0); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CALCULADORA MULTI-CATEGORIA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let margemAtual = 20;
function setMargem(v) {
  margemAtual = v;
  document.querySelectorAll('.mpill').forEach(p=>p.classList.toggle('on',p.getAttribute('onclick').includes('('+v+')')));
  document.getElementById('margem-label').textContent = v;
  calcPreco();
}

function calcPreco() {
  const c = getConfig(); const cm = custoMin(c);
  let totalMin=0, matCusto=0, rows=[], mo=0, embalagem=0;

  if(catAtual==='bordado') {
    const minBord=(+gv('b_min_bord')||0)*(+gv('b_complexidade')||1);
    const minCos=+gv('b_min_cos')||0; const minAcab=+gv('b_min_acab')||0;
    totalMin=minBord+minCos+minAcab; mo=totalMin*cm;
    const linhas=(+gv('b_linhas')||0)*(+gv('b_linha_val')||18);
    const extras=totalInsumos('bordado');
    matCusto=linhas+extras;
    rows=[
      {l:'üë©‚Äçüé® M√£o de obra',v:mo,hint:`${(totalMin/60).toFixed(2)}h √ó R$${custoHora(c).toFixed(2)}/h`},
      {l:'ü™° Linhas de bordar',v:linhas},
      {l:'üß∂ Materiais diretos',v:extras},
    ];
  }
  else if(catAtual==='ajuste') {
    const minCos=(+gv('aj_min_cos')||0)*(+gv('aj_complexidade')||1);
    const minAcab=+gv('aj_min_acab')||0;
    totalMin=minCos+minAcab; mo=totalMin*cm;
    const ziper=+gv('aj_ziper')||0;
    const elastico=(+gv('aj_elastico_m')||0)*(+gv('aj_elastico_val')||3.5);
    const botao=(+gv('aj_botao_qtd')||0)*(+gv('aj_botao_val')||1.5);
    const entretela=+gv('aj_entretela')||0; const tecido=+gv('aj_tecido')||0; const linha=+gv('aj_linha')||0;
    matCusto=ziper+elastico+botao+entretela+tecido+linha;
    rows=[
      {l:'‚úÇÔ∏è M√£o de obra (costura/m√°quina)',v:mo,hint:`${(totalMin/60).toFixed(2)}h √ó R$${custoHora(c).toFixed(2)}/h`},
      ...(ziper>0?[{l:'üîó Z√≠per',v:ziper}]:[]),
      ...(elastico>0?[{l:'„Ä∞Ô∏è El√°stico',v:elastico}]:[]),
      ...(botao>0?[{l:'üîò Bot√µes',v:botao}]:[]),
      ...(entretela>0?[{l:'üß± Entretela',v:entretela}]:[]),
      ...(tecido>0?[{l:'üß∂ Tecido extra',v:tecido}]:[]),
      ...(linha>0?[{l:'ü™° Linha especial',v:linha}]:[]),
    ];
  }
  else if(catAtual==='chaveiro') {
    const minSolda=(+gv('ch_min_solda')||0)*(+gv('ch_complexidade')||1);
    const minCos=+gv('ch_min_cos')||0; const minAcab=+gv('ch_min_acab')||0;
    const unid=+gv('ch_unid')||1;
    totalMin=minSolda+minCos+minAcab; mo=totalMin*cm;
    const base=+gv('ch_material_base')||0; const argola=+gv('ch_argola')||0;
    const fio=+gv('ch_fio')||0; const enfeites=+gv('ch_enfeites')||0; const outros=+gv('ch_outros_mat')||0;
    matCusto=(base+argola+fio+enfeites+outros)/unid;
    mo=mo/unid;
    rows=[
      {l:'üî• M√£o de obra (solda + costura)',v:mo,hint:`${(totalMin/60).toFixed(2)}h √∑ ${unid} un`},
      {l:'üîë Material base',v:base/unid},
      ...(argola>0?[{l:'‚≠ï Argola / mosquet√£o',v:argola/unid}]:[]),
      ...(fio>0?[{l:'ü™° Fio / linha',v:fio/unid}]:[]),
      ...(enfeites>0?[{l:'‚ú® Enfeites / pingentes',v:enfeites/unid}]:[]),
      ...(outros>0?[{l:'üì¶ Outros materiais',v:outros/unid}]:[]),
    ];
  }
  else if(catAtual==='bolsa') {
    const minCorte=+gv('bl_min_corte')||0;
    const minCos=+gv('bl_min_cos')||0;
    const minBord=(+gv('bl_min_bord')||0)*(+gv('bl_complexidade')||1);
    const minAcab=+gv('bl_min_acab')||0;
    totalMin=minCorte+minCos+minBord+minAcab; mo=totalMin*cm;
    const tec=+gv('bl_tec_ext')||0; const forro=+gv('bl_forro')||0;
    const entretela=+gv('bl_entretela')||0; const ziper=+gv('bl_ziper')||0;
    const alca=+gv('bl_alca')||0; const linhas=(+gv('bl_linhas')||0)*(+gv('bl_linha_val')||18);
    const outros=+gv('bl_outros')||0;
    matCusto=tec+forro+entretela+ziper+alca+linhas+outros;
    rows=[
      {l:'‚úÇÔ∏è M√£o de obra (corte + costura + bordado)',v:mo,hint:`${(totalMin/60).toFixed(2)}h √ó R$${custoHora(c).toFixed(2)}/h`},
      ...(tec>0?[{l:'üß∂ Tecido externo',v:tec}]:[]),
      ...(forro>0?[{l:'ü™¢ Forro interno',v:forro}]:[]),
      ...(entretela>0?[{l:'üß± Entretela / manta',v:entretela}]:[]),
      ...(ziper>0?[{l:'üîó Z√≠per',v:ziper}]:[]),
      ...(alca>0?[{l:'ü§ù Al√ßa / fita',v:alca}]:[]),
      ...(linhas>0?[{l:'ü™° Linha de bordar',v:linhas}]:[]),
      ...(outros>0?[{l:'üì¶ Outros aviamentos',v:outros}]:[]),
    ];
  }
  else if(catAtual==='enxoval_bebe') {
    const minBord=(+gv('eb_min_bord')||0)*(+gv('eb_complexidade')||1);
    const minCos=+gv('eb_min_cos')||0; const minAcab=+gv('eb_min_acab')||0;
    const unid=+gv('eb_unid')||1;
    totalMin=minBord+minCos+minAcab; mo=(totalMin*cm)/unid;
    const tec=+gv('eb_tecido')||0; const linhas=(+gv('eb_linhas')||0)*(+gv('eb_linha_val')||18);
    const avia=+gv('eb_aviamentos')||0; const embal=+gv('eb_embal')||0;
    const extras=totalInsumos('enxoval_bebe');
    matCusto=(tec+linhas+avia+extras)/unid;
    embalagem=embal/unid;
    rows=[
      {l:'üë©‚Äçüé® M√£o de obra',v:mo,hint:`${(totalMin/60).toFixed(2)}h √∑ ${unid} un`},
      ...(tec>0?[{l:'üß∂ Tecido',v:tec/unid}]:[]),
      ...(linhas>0?[{l:'ü™° Linha de bordar',v:linhas/unid}]:[]),
      ...(avia>0?[{l:'üîó Aviamentos',v:avia/unid}]:[]),
      ...(extras>0?[{l:'üì¶ Outros materiais',v:extras/unid}]:[]),
    ];
  }
  else if(catAtual==='enxoval_casa') {
    const minBord=(+gv('ec_min_bord')||0)*(+gv('ec_complexidade')||1);
    const minCos=+gv('ec_min_cos')||0;
    const unid=+gv('ec_unid')||1;
    totalMin=minBord+minCos; mo=(totalMin*cm)/unid;
    const tec=+gv('ec_tecido')||0; const linhas=(+gv('ec_linhas')||0)*(+gv('ec_linha_val')||18);
    const avia=+gv('ec_aviamentos')||0; const embal=+gv('ec_embal')||0;
    const extras=totalInsumos('enxoval_casa');
    matCusto=(tec+linhas+avia+extras)/unid;
    embalagem=embal/unid;
    rows=[
      {l:'üë©‚Äçüé® M√£o de obra',v:mo,hint:`${(totalMin/60).toFixed(2)}h √∑ ${unid} un`},
      ...(tec>0?[{l:'üß∂ Tecido/toalha/len√ßol',v:tec/unid}]:[]),
      ...(linhas>0?[{l:'ü™° Linha de bordar',v:linhas/unid}]:[]),
      ...(avia>0?[{l:'üîó Aviamentos',v:avia/unid}]:[]),
      ...(extras>0?[{l:'üì¶ Outros materiais',v:extras/unid}]:[]),
    ];
  }
  else if(catAtual==='etiqueta') {
    const minBord=(+gv('et_min_bord')||0)*(+gv('et_complexidade')||1);
    const minAcab=+gv('et_min_acab')||0;
    const qtd=+gv('et_qtd')||1;
    totalMin=minBord+minAcab; mo=(totalMin*cm)/qtd;
    const fita=+gv('et_fita')||0; const linhas=(+gv('et_linhas')||0)*(+gv('et_linha_val')||18);
    const embal=+gv('et_embal')||0;
    matCusto=(fita+linhas)/qtd; embalagem=embal/qtd;
    rows=[
      {l:`üë©‚Äçüé® M√£o de obra (√∑ ${qtd} etiquetas)`,v:mo,hint:`${(totalMin/60).toFixed(2)}h total`},
      ...(fita>0?[{l:'üéÄ Fita / tecido',v:fita/qtd}]:[]),
      ...(linhas>0?[{l:'ü™° Linha de bordar',v:linhas/qtd}]:[]),
    ];
  }

  else if(catAtual==='outros') {
    const minTotal=(+gv('ou_min_total')||0)*(+gv('ou_complexidade')||1);
    const unid=+gv('ou_unid')||1;
    totalMin=minTotal; mo=(totalMin*cm)/unid;
    const linhas=(+gv('ou_linhas')||0)*(+gv('ou_linha_val')||18);
    const insFixos=+gv('ou_insumos_fixos')||0;
    const extras=totalInsumos('outros');
    matCusto=(linhas+insFixos+extras)/unid;
    rows=[
      {l:'üë©‚Äçüé® M√£o de obra',v:mo,hint:`${(totalMin/60).toFixed(2)}h √∑ ${unid} un`},
      ...(linhas>0?[{l:'ü™° Linha / fio',v:linhas/unid}]:[]),
      ...(insFixos>0?[{l:'üì¶ Insumos diversos',v:insFixos/unid}]:[]),
      ...(extras>0?[{l:'üß∂ Materiais extras',v:extras/unid}]:[]),
    ];
  }

  // embalagem geral
  const embalGeral=(+gv('g_embal')||0)+(+gv('g_etiqu')||0)+(+gv('g_tag')||0)+(+gv('g_embal2')||0);
  embalagem += embalGeral;
  const frete=+gv('g_frete')||0;
  const mktTaxa=+gv('g_mkt_taxa')||0;
  const descontoPct=+gv('g_desconto')||0;

  const custoUnit=mo+matCusto+embalagem+frete;
  const lucro=custoUnit*(margemAtual/100);
  const sub=custoUnit+lucro;
  const mktVal=sub*(mktTaxa/100);
  const precoAntes=sub+mktVal;
  const descVal=precoAntes*(descontoPct/100);
  const final=precoAntes-descVal;

  const allRows=[
    ...rows,
    ...(embalagem>0?[{l:'üì¶ Embalagem & apresenta√ß√£o',v:embalagem}]:[]),
    ...(frete>0?[{l:'üöö Frete de materiais',v:frete}]:[]),
    {l:'‚îÄ Custo unit√°rio',v:custoUnit,sep:true},
    {l:`üìà Margem de lucro (${margemAtual}%)`,v:lucro,hl:true},
    ...(mktTaxa>0?[{l:`üõí Taxa marketplace (${mktTaxa}%)`,v:mktVal}]:[]),
    ...(descontoPct>0?[{l:`üè∑ Desconto (${descontoPct}%)`,v:-descVal}]:[]),
  ];

  document.getElementById('result-rows').innerHTML = allRows.map(r=>`
    <div class="r-row${r.hl?' highlight':''}">
      <span class="lbl">${r.l} ${r.hint?`<span style="opacity:0.45;font-size:0.75rem;">${r.hint}</span>`:''}</span>
      <span class="val" style="${r.sep?'border-top:1px solid var(--border);padding-top:4px;':''}">${r.v<0?'- ':''}R$ ${Math.abs(r.v).toFixed(2)}</span>
    </div>`).join('');
  document.getElementById('preco-final').textContent = `R$ ${final.toFixed(2)}`;
  return { mo, matCusto, embalagem, frete, custoUnit, lucro, mktVal, descVal, final, totalMin, mkt_taxa:mktTaxa, desconto:descontoPct };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SALVAR / LIMPAR / EDITAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildProd(calc) {
  if(!calc) calc = calcPreco();
  return {
    id: Date.now(),
    cat: catAtual,
    catLabel: CAT_LABELS[catAtual],
    nome: gv('p_nome').trim(), emoji: gv('p_emoji'), desc: gv('p_desc'),
    custo: calc.custoUnit, preco: calc.final, margem: margemAtual,
    mo: calc.mo, matCusto: calc.matCusto, embalagem: calc.embalagem,
    frete: calc.frete, mkt_taxa: calc.mkt_taxa, desconto: calc.desconto,
    totalMin: calc.totalMin,
    data: new Date().toLocaleDateString('pt-BR'), dataSalvo: new Date().toISOString(),
  };
}

async function salvar() {
  const nome = gv('p_nome').trim();
  if(!nome) { toast('Preencha o nome do produto',false); return; }
  const calc = calcPreco(); const prod = buildProd(calc);
  showLoading(true);
  let lista = await cloudGet(KEYS.produtos) || [];
  lista.push(prod);
  const ok = await cloudSet(KEYS.produtos, lista);
  showLoading(false);
  if(ok) { toast(`"${nome}" salvo!`); if(confirm('Ir para "Meus Produtos"?')) showPage('produtos'); }
  else toast('Erro ao salvar',false);
}

async function salvarSheets() {
  const nome = gv('p_nome').trim();
  if(!nome) { toast('Preencha o nome do produto',false); return; }
  const calc = calcPreco(); const prod = buildProd(calc);
  showLoading(true);
  let lista = await cloudGet(KEYS.produtos) || [];
  lista.push(prod);
  await cloudSet(KEYS.produtos, lista);
  const ok = await enviarParaSheets(prod);
  showLoading(false);
  if(ok) toast(`"${nome}" salvo e enviado ao Sheets!`);
  else toast(`"${nome}" salvo localmente (Sheets pode ter atrasado)`,false);
}

function limpar() {
  ['p_nome','p_desc'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
  // reset todos os campos num√©ricos
  document.querySelectorAll('.page#page-calc input[type=number]').forEach(el=>el.value=el.defaultValue||'0');
  Object.keys(insumos).forEach(g=>{ insumos[g]=[]; renderInsumos(g); });
  setMargem(20); calcPreco();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENDER PRODUTOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let filtroAtual = 'todos';
function filtrarProd(cat) {
  filtroAtual = cat;
  document.querySelectorAll('[id^="filtro-"]').forEach(b=>{ b.style.borderColor=''; b.style.color=''; });
  const btn = document.getElementById('filtro-'+cat);
  if(btn) { btn.style.borderColor='var(--rose)'; btn.style.color='var(--rose)'; }
  renderProdutos();
}

async function renderProdutos() {
  showLoading(true);
  let lista = await cloudGet(KEYS.produtos) || [];
  showLoading(false);
  if(filtroAtual!=='todos') lista=lista.filter(p=>p.cat===filtroAtual);
  const el = document.getElementById('prod-grid');
  const sheetsUrl = await cloudGet(KEYS.sheetsUrl);
  if(!lista.length) {
    el.innerHTML=`<div class="empty" style="grid-column:1/-1;"><span class="empty-icon">üßµ</span><h3>Nenhum produto aqui ainda</h3><p>Calcule e salve um produto para aparecer aqui.</p></div>`;
    return;
  }
  el.innerHTML = lista.map(p=>`
    <div class="prod-card">
      <div class="prod-card-top">
        <div class="prod-emoji">${p.emoji}</div>
        <div class="prod-meta"><h3>${p.nome}</h3><div class="cat">${p.catLabel||p.cat} ¬∑ ${p.data}</div></div>
      </div>
      <div class="prod-card-body">
        <div class="prod-price">R$ ${parseFloat(p.preco).toFixed(2)}</div>
        <div class="prod-cost">Custo: R$${parseFloat(p.custo).toFixed(2)} ¬∑ Margem: ${p.margem}%</div>
        ${p.desc?`<div class="prod-desc">${p.desc.slice(0,90)}${p.desc.length>90?'...':''}</div>`:''}
        <div class="prod-actions">
          ${sheetsUrl?`<button class="btn btn-google-green btn-sm" onclick="sendOneToSheets(${p.id})">üìä Sheets</button>`:''}
          <button class="btn btn-danger btn-sm" onclick="deletarProd(${p.id})">üóë Remover</button>
        </div>
      </div>
    </div>`).join('');
}

async function deletarProd(id) {
  if(!confirm('Remover este produto?')) return;
  showLoading(true);
  let lista = await cloudGet(KEYS.produtos) || [];
  lista = lista.filter(p=>p.id!==id);
  await cloudSet(KEYS.produtos, lista);
  showLoading(false);
  toast('Produto removido'); renderProdutos();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CAT√ÅLOGO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function renderCatalogo() {
  showLoading(true);
  const lista = await cloudGet(KEYS.produtos) || [];
  showLoading(false);
  updateNome(); if(logoDataUrl) applyLogo(logoDataUrl);
  const el = document.getElementById('cat-grid');
  if(!lista.length) { el.innerHTML=`<div class="empty" style="grid-column:1/-1;"><span class="empty-icon">üìñ</span><h3>Cat√°logo vazio</h3><p>Salve produtos para montar o cat√°logo.</p></div>`; return; }
  el.innerHTML = lista.map(p=>`
    <div class="cat-item">
      <div class="cat-item-img">${p.emoji}</div>
      <div class="cat-item-body">
        <div class="cat-item-name">${p.nome}</div>
        ${p.desc?`<div class="cat-item-desc">${p.desc.slice(0,100)}${p.desc.length>100?'...':''}</div>`:''}
        <div class="cat-item-price">R$ ${parseFloat(p.preco).toFixed(2)}</div>
        <div class="cat-item-cat">${p.catLabel||p.cat}</div>
      </div>
    </div>`).join('');
}
function shareCatalog() {
  if(navigator.share) navigator.share({title:'Cat√°logo',text:'Confira nosso cat√°logo!'}).catch(()=>{});
  else toast('Use "Imprimir / PDF" para salvar e compartilhar',false);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GOOGLE SHEETS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let sheetsConnected = false;

async function refreshGooglePage() {
  const url = await cloudGet(KEYS.sheetsUrl);
  if(url) { document.getElementById('sheets_url').value=url; setConnectedState(true); }
}
function setConnectedState(v) {
  sheetsConnected = v;
  const badge=document.getElementById('google-status-badge');
  const statusText=document.getElementById('google-status-text');
  const chip=document.getElementById('google-status-chip');
  const card=document.getElementById('google-card-status');
  const cardSync=document.getElementById('card-sync');
  const btnSheets=document.getElementById('btn-salvar-sheets');
  if(v) {
    badge.classList.add('connected'); statusText.textContent='Sheets conectado'; chip.textContent='‚úì Conectado';
    chip.style.background='rgba(15,157,88,0.1)'; chip.style.borderColor='rgba(15,157,88,0.3)'; chip.style.color='var(--google-green)';
    card.classList.add('connected'); cardSync.style.display='block'; if(btnSheets) btnSheets.style.display='inline-flex';
  } else {
    badge.classList.remove('connected'); statusText.textContent='Conectar Google'; chip.textContent='N√£o configurado';
    chip.style.background=''; chip.style.borderColor=''; chip.style.color='';
    card.classList.remove('connected'); cardSync.style.display='none'; if(btnSheets) btnSheets.style.display='none';
  }
}
async function conectarSheets() {
  const url = document.getElementById('sheets_url').value.trim();
  if(!url||!url.startsWith('https://script.google.com')) { toast('URL inv√°lida',false); return; }
  const feedback = document.getElementById('conn-feedback');
  feedback.style.display='block'; feedback.innerHTML='<span style="color:var(--text-muted);">üîÑ Testando...</span>';
  try {
    await fetch(url,{method:'GET',mode:'no-cors'});
    await cloudSet(KEYS.sheetsUrl,url);
    feedback.innerHTML='<span style="color:var(--google-green);">‚úì Conex√£o salva! O Apps Script pode levar alguns segundos para responder nas primeiras chamadas.</span>';
    setConnectedState(true); toast('Google Sheets conectado!');
  } catch(e) {
    feedback.innerHTML=`<span style="color:var(--danger);">‚ö† N√£o foi poss√≠vel conectar: ${e.message}</span>`;
    toast('Erro de conex√£o',false);
  }
}
async function desconectarSheets() {
  if(!confirm('Desconectar do Google Sheets?')) return;
  try { await window.storage.delete(KEYS.sheetsUrl); } catch{}
  document.getElementById('sheets_url').value=''; setConnectedState(false); toast('Desconectado');
}
async function enviarParaSheets(prod) {
  const url = await cloudGet(KEYS.sheetsUrl);
  if(!url) { toast('Configure o Google Sheets primeiro',false); return false; }
  try {
    await fetch(url,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(prod)});
    return true;
  } catch(e) { console.error('Sheets error',e); return false; }
}
async function sendOneToSheets(id) {
  const lista = await cloudGet(KEYS.produtos) || [];
  const p = lista.find(p=>p.id===id); if(!p) return;
  showLoading(true); const ok=await enviarParaSheets(p); showLoading(false);
  if(ok) toast(`"${p.nome}" enviado ao Sheets!`); else toast('Erro ao enviar',false);
}
async function syncAllToSheets() {
  showLoading(true);
  const lista = await cloudGet(KEYS.produtos) || [];
  const log = document.getElementById('sync-log');
  if(!lista.length) { showLoading(false); toast('Nenhum produto para sincronizar',false); return; }
  log.innerHTML=`üîÑ Enviando ${lista.length} produto(s)...`; let ok=0;
  for(const p of lista) { const sent=await enviarParaSheets(p); if(sent) ok++; await new Promise(r=>setTimeout(r,300)); }
  showLoading(false);
  log.innerHTML=`‚úÖ ${ok}/${lista.length} produto(s) enviados ao Google Sheets!`;
  toast(`${ok} produto(s) sincronizados!`);
}
function copiarScript() {
  const code = document.getElementById('script-code-box').textContent;
  navigator.clipboard.writeText(code).then(()=>toast('C√≥digo copiado!')).catch(()=>toast('Erro ao copiar',false));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function init() {
  showLoading(true);
  await loadConfig();
  const logo = await cloudGet(KEYS.logo); if(logo) applyLogo(logo);
  const sheetsUrl = await cloudGet(KEYS.sheetsUrl); if(sheetsUrl) setConnectedState(true);
  showLoading(false);
  calcPreco();
}
init();
</script>
</body>
</html>
